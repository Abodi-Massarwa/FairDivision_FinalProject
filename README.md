עמוד | **20**

חלוקה הוגנת של חפצים שונים תחת אילוצי מטרואיד 

הטרוגניים 

הקדמה : 

` `ההתמקדות העיקרית במחקר על הקצאה הוגנת של (חפצים/משאבים/פריטים) שלא ניתנות לחלוקה בין אנשים בעלי יכולות/קיבוליות שונות והערכות שווי שונות עבור כל פריט כמו חלוקת משימות בין עובדים בצוות Full stack, אחד עשוי להעדיף עיצוב ממשק המשתמש, אחר אולי יעדיף לכתוב תרשימים ושרטוטים, ואחר אולי יעדיף ליישם קוד ולפתור בעיות, מבחינת אילוצי היתכנות עובד אחד יכול להיות בסדר עם ביצוע כל המשימות, אחרים עשויים להיות קצרים בזמן ולכן הם מעדיפים לקחת פחות משימות.

המטרה הראשית של זה לפתח אלגוריתמים שפותרות בעיות מהסוג שנזכר לעיל בהינתן קיבוליות והעדפות שונות. 

החשיבות והמוטיבציה מאחורי מחקר זה היא לפתור בעיות שאנו מתמודדים איתנו בחיי היומיום, זה חשוב גם עבור קהילת הבינה המלאכותית

כחלק מהמכשולים בבעיה היא העובדה שקשה להשיג EF (ללא קנאה: פירוש הדבר שכולם מרוצים מהחבילה שהם קיבלו מכיוון שהם חושבים שזה החבילה הטובה ביותר מכל החבילות) כאשר הפריטים שאנו עוסקים בהם אלה שאינם ניתנים לחלוקה.

אז אנו מתרכזים במה שאנו מכנים EF-1 (ללא קנאה עד פריט אחד) כלומר הסוכן i מרוצה מהחבילה שהוא קיבל במצב אחד, אם מורידים את הפריט הטוב ביותר מהתיק של סוכן j.

החוקרים במאמר זה מתמקדים בזה שהחבילות (חלוקה של כל סוכן ) הן קבוצות בלתי תלויות במטרואיד(נראה בהמשך הגדרה פורמלית).

**היו כמה מחקרים קודמים שעסקו בתחום הזה שהובילו לתוצאות שונות שכדאי להציג אותן :** 

1. Biswas and Barman (2018, 2019)  עסקו בהערכת שווי אדיטיבית (שאנחנו משתמשים בה המון במחקר שלנו) אבל לא מצליחים למצוא EF-1 תחת אילוצי מטרואיד חלוקה שונים או זהים בהינתן הערכות שווי שונות 
1. (Lipton, Markakis, Mossel, & Saberi, 2004)  מצאו כי אפשר להשיג ביעילות חלוקה EF-1 אבל ללא אילוצים 
1. 3.	(Oxley,2006) קצת בכיוון שונה למה שנדון בו במחקר הם התמקדו בהערכה סאב-מודולרית ז"א שהערך של חבילה מסוימת זה לא סכום הערכים של כל פריט אלא הערך הכי טוב של תת-חבילה ב 2020 חוקרים אחרים שיפרו להערכה בינרית כזו (0 לא רוצה 1 רוצה ) אבל הבעיה בהגדרה כזו זה סילוק הפריטים לאחר הקצאה שזה לא טוב במקרה שלנו אנו רוצים הקצרה שלמה שתכלול את כל הפריטים 

` `**בעיה פתוחה היא קיומן של הקצאות שלמות EF1 בין סוכנים הטרוגניים כאשר ההטרוגניות היא גם במגבלות הקיבולת של הסוכנים וגם בהערכות השווי שלהם.**

**אִי-אֶפְשָׁרוּיות**

החוקרים נפגשו עם כמה דברים שבוודאות אי אפשר להשיג אותן כמו : 

1. מגבולות חלוקה שונים לכל סוכן גורם למצוא F-EF1 בלתי אפשרי 
1. ללכת מעבר למגבולות מטרואיד גם לא תורם למטרה 
1. ללכת להגדרה יותר חזקה מ EF-1 זה גם לא יעזור (EFX)

כתוצאה מכך החוקרים מתמקדים בלמצוא חלוקות F-EF1 ב: 

1. אילוצי מטרואיד חולקה זהים כך שיתכן קיבוליות שונות לכל אחד 
1. מטרואידות BO כך שלכל הסוכנים יש אילוצים זהים יתכן הערכות-שווי שונות 

**דיבור בקצרה על הלאגורתמים שיתרחשו בהמשך :** 

1. המכשול במחקר של ברמן ועוד חוקרים שנזכר לעיל זה שלא יכלו להתמודד עם קיבולת שונה לכל סוכן מכיוון שהפעולה של הורדת מעגלים בגרף קנאה לא מובטחת מכיוון שהיא כוללת החלפת פריטים בין סוכנים שזה לא בטוח יקיים את תנאי האילוצים לכן במחקר הזה מתמקדים תחת הגדרות שבכלל מונעות את הסיטואציה של קיום מעגל בגרף זה שחוסך אותנו מלהיות בספק אם חרגנו או לא
1. מטרואידות BO (מעבר למטרואידות חלוקה) זה קלאס רחב של מטרואידות שכמעט רוב המטרואידות משתייכות לו בקלאס הזה החוקרים ייפתחו אלגוריתם בפרק 8 במאמר תחת אילוצים זהים ויתכן הערכות שונות 

**מחקרים שונים שקשורים למאמר :**

קיימים כמה מחקרים שונים שתחומם קשור למאמר שלנו נציג אותן בקצרה ונדגיש את ההבדל ביניהם למאמר שלנו 
המחקרים השונים מחולקים לפי האילוצים השונים 

הקצאה מאוזנת : היא הקצאה שבה כל הסוכנים מקבלים אותו מספר של פריטים עד כדי פריט אחד נוסף

**אילוצי קיבולת:** 

היו כמה מאמרים שחקרו דברים שונים כמו 

1) (Garg et al., 2010; Long, Wong, Peng, &

Ye, 2013; Lian, Mattei, Noble, & Walsh, 2018).

ייתכן שהאילוצים שונים לכל אחד אבל יש רק קטגוריה אחת 

1) Ferraioli, Gourv`es, and Monnot (2014),

כל אחד חייב לקבל K פריטים 

1) אלגורתם ROUND ROBIN  מוצא הקצאות של EF-1 לכל מספר של סוכנים עם הערכות אדיטיביות
1) Kyropoulou, Suksompong,
   להם יש אלגורתם שמוצא חלוקה EF-1 ל2 סוכנים עם הערכות מונוטניות
1) Gafni, Huang, Lavi, and Talgam-Cohen (2021)
   חקרו הקצאה הוגנת תחת הגדרות קשורות כך ש למשאבים ייתכן כפיליות
1) יש כאלה שחקרו גם הקצאה הוגנת תחת הגדרה של RANKING

**אילוצי מטרואיד :**

Gourv`es, Monnot, and Tlilane (2014) ו- Gourv`es and

Monnot (2019) דורשים שאיחוד החבילות שהוקצו לכל הסוכנים יהיה עצמאי

סט של המטרויד. זה מחייב להשאיר כמה פריטים לא מוקצים, מה שלא

מותר בתנאי סביבה שלנו.

**אילוצי תקציבים :** 

יש כאלה שחקרו תחת הגדרה של מגבלת תקציב לכל סוכן כך שהחבילות האפשריות חייבות לקיים שסכום המחירים שלהם קטן שווה לתקציב של כל סוכן 

**אילוצי DOWNWARD CLOSED**

Li and Vetta (2021) study fair allocation with downward-

closed constraints,

שחקרו הקצאה הוגנת תחת אילוצים ספיציפיים במטרואיד הכללי שזה גם כולל אילוצי תקציבים

**אילוצי ללא-סכסוך** 

- Li, Li, and Zhang (2021) חקרו הקצאה הוגנת עם אילוצי תזמון כך שמתייחסים לכל משאב בתור אינטרוול של זמן וכל החבילות האפשריות הם אלה שאין בהן 2 משאבים שמתנגשים אחד עם השני
- Hummel and Hetland (2022) חקרו את זה קצת יותר כללי דרך "גרף סכסוך" כך שכל חבילה אפשרית לא כוללת 2 צמתים סמוכים בגרף (משתפות אותה צלע)




**אילוצי קשירות** 

Barrera, Nyman, Ruiz, Su, and Zhang (2015), Bil`o, Caragiannis,

Flammini, Igarashi, Monaco, Peters, Vinci, and Zwicker (2018), and Suksompong

- (2019)

חקרו חלוקה הוגנת תחת ההגדרה של אילוץ שונה כך ש מסדרים את המשאבים בשורה וכל סוכן אמור לקבל תת שורה מקושרת ברצף הזה 

Bouveret, Cechl´arov´a, Elkind,

- Igarashi, and Peters (2017) and Bei, Igarashi, Lu, and Suksompong (2019)

חקרו משהו שהוא גם דומה אבל הפעם תחת אילוץ של לקבל תת-גרף מהגרף הכללי

**אילוצים לא-אדיטיביים**

Bei, Garg, Hoefer,

- and Mehlhorn (2017) and Anari, Mai, Gharan, and Vazirani (2018)
  חקרו הקצאה של פרטים שמחולקים לדגמים ולכל דגם יש כמות תחת אילוץ אדיטיבי בין הדגמים אבל אילוץ MARGINAL RETURNS בין היחידות (ז"א שככל שאנחנו לוקחים מאותו דגם עוד יחידה של משאב ככל שההערכה יורדת)
- Garg, Hoefer, and Mehlhorn (2018)
  חקרו הערכה אדיטיבית-תקציבית כך שיש גבול מסויים לכל סוכן וההערכה לבאנדלים זה MIN(הערך המוגבל, ערך אדיטיבי של סכום הפריטים בחבילה) ז"א שנגיע למצב לא כדאי לנו לקחת יותר פריטים כי בעינינו זה אותו ערך
- יש כאלה שגם חקרו הערכה סאב-מודלרית(הוספת פריטים לקבוצה קטנה יותר עלולה להשפיע על ההערכה לטובה יותר) 

**הגדרות ומושגים** 

**הקצאות ואילוצים**

נגדיר M להיות הקבוצה של הפריטים שנדון בלחלק אותם לסוכנים שלקבוצתם קוראים N. הקצאה מסומנת כ X = (X1, . . . ,Xn)

כך ש X היא הקבוצה שמכילה כל  X<sub>i</sub>שמשמעותו ההקצאה של של סוכן i , כך שכל הקצאה היא תת קבוצה של M ונדאג שלכל שני סוכנים החיתוך ריק משמעותו אין כפילות של פריטים.

להקצאה קוראים הקצאה שלמה כשמתקיים שהאיחוד של כל ההקצאות של הסוכנים שווה לקבוצה M משמעותו שהצלחנו לחלק את כל הפריטים ולא נותר לנו כלום בהמשך המאמר ישומש הסימן [n]שמהווה {1, . . . , n}.

נתמקד במאמר בהגדרות מוגבלות תחת מה שקוראים לו מטרואיד לכל סוכן יהיה מטרואיד משלו שדרכה מוגדרות החבילות המתאימות עבורו לקחת ולהיות מרוצה.

**הגדרה 1** : מטאואיד זה זוג סדור M = (M, I), כך ש M זה כפי שסברנו לעיל קבוצת הפריטים ו I זו תת קבוצה של קבוצת החזקה  של M והיא לא ריקה ומכילה קבוצות בלתי תלויות שמקיימות את התכונות הבאות : 

1. כל תת קבוצה של אחת הקבוצות האלה היא גם נמצאת ב I 
1. קיים g לכל 2 קבוצות שונות בגודל כך שהאיחוד שלו עם הקבוצה הקטנה גם שייך ל I 

יש לנו עוד 2 סוגים יותר ממוקדים של מטרואידות שזה 

1. מטרואיד חלוקה :  כפי ששמו אומר המטרויאד הזה מתייחס בואפן ספיציפי לחלוקת הפריטים ב M לקטגוריות שכל קטגוריה מאפיין אותה היכולת של הסוכן i להחזיק דברים ממנה (מקטגרים את הפריטים שב M לכל סוכן תחת הפרמטר של כמה הוא יכול להחזיר מכל קטגוריה)

כל זה מגביל את I שלנו להכיל רק את הבאנדלים שמקיימים את התכונה שהמספר של הפריטים מכל קטגוריה לא חורג מהמקסימום שמוגדר לו.

1. מטרואיד אחיד : שזה במילים אחרות מקרה פרטי של מטרואיד חלוקה שיש לו אך ורק קטגוריה אחת 

**הגדרה 3** : הקצאה ישימה זו הקצאה ש : 

1. שייכת ל I של הסוכן 
1. שלמה משמעותה שהאיחוד של כל ההקצאות של הסוכנים נותן M


**הערכות ומילות מפתח על הוגנות :** 

הערכה אדיטיבית היא הערכה כפי ששמה אומר , תמורת באנדל מסיים היא סכום התמורות של כל פריט בבאנדל לפי הסוכן ה i

בעיקר יש לנו 2 סוגים של הערכות אדיטביות 

1. מספרית (כמו רייטינג)
1. בינרית (רוצה / לא רוצה)


**קנאה ואי קנאה**

סוכן i נקרא מקנה בסוכן j אמ"ם <a name="_hlk156117086"></a><a name="_hlk156117111"></a>vi(Xi) < vi(Xj).

(נשים לב שהפונקציה משני הצדדים היא של סוכן i)


**תת חבילה הכי ישימה:** 

בהינתן חבילה ששייכת ל I  סוכן i יכול לחשב את התת-חבילה הכי משתלמת ממנה ע"יי חיפוש התת קבוצה הכי מקסמלית מבחינת ערך בעיניו (נשים לב שגם התת באנדל אמור להיות שייך ל I)

**תת קבוצה ישימה מקסימלית:** 

מוגדרת להיות קבוצת התתי חבילות של חבילה T כך שערכם מקסימלי (ייתכן יותר מתת קבוצה אחת בעלת ערך MAX) , זו הגדרה שימושית במקרה של F-EF1 

**הערכת שווי ישימה :** 

זה פשוט מוגדר להיות Vi(best feasible subset) שנמצא בגדרה הקודמת 

**בהינתן הקצאה X :** 

- סוכן i F-מקנה בסוכן j כשמתקיים <i>v</i>ˆ<i><sub>i</sub></i>(<i>X<sub>i</sub></i>) <i>< v</i>ˆ<i><sub>i</sub></i>(<i>X<sub>j</sub></i>). (נשים לב לקובע על ה v משמעותו ערך של תת חבילה מקסימלית בהתאם לגודל חבילה של i)
- ישים-F-ללא קנאה כשאין אף אחד שמקנה בשני 
- F-EF1 כשלכל סוכן i ו j , Y ⊆Xj כך שהגודל של Y לכל היותר 1 מתקיים <i>v</i>ˆ<i><sub>i</sub></i>(<i>X<sub>i</sub></i>) ≥ <i>v</i>ˆ<i><sub>i</sub></i>(<i>X<sub>j</sub></i> \ <i>Y</i> ).

**קנאה ישימה חיובית :**

X(i, j) := max(0, ˆvi(Xj) − ˆvi(Xi)). קנאה + 

ז"א במידה וההפרש שלילי אז אין קנאה לכן לוקחים את 0

**גרף קנאה :** 

גרף קנאה הוא גרף שהצמתים מוגדרות בו להיות הסוכנים וקיים צלע מצומת i לצומת j אמ"ם vi(Xi) < vi(Xj) 



**חלוקה יעילה פארטו :** 

זו חלוקה שלא קיים לה שיפור פאריטו ז"א שאין חלוקה יותר טובה ז"א אין חלוקה שבה הערכים החדשים לכל חבילה בעיני הסוכנים גדול שווה לערך של החבילות בחלוקה הנוכחית

**MAX-NASH-WELFARE:**

אנו לא רוצים להיכנס עמוק ולסבך את הקורא פה לכן בכמה מילים nash-welfare זה פשוט פונקציה מופעלת על חלוקה ישימה מחשבת שורש של מכפלות ההערכות שווי של כל סוכן לחבילה שלו (מכפלת ערכי חבילות של כל סוכן לפי הvi שלו) המקסימום נאש וילפייר זה פשוט החלוקה הממקסמת את תוצאת הפונקציה הזו . 


**האלגורתמים** 

**אלגוריתם 1 : per category round robin**

כפי ששמו אומר האלגוריתם מסתמך על זה שהוא רץ בלולאה על הקטגוריות וזה בעייתי בהנחה שהקלט שלנו הוא אוסף של סוכנים שיש להם אותה הגבלת חלוקה לאו דווקא אותה קיבולת 

1) מתחילים עם סדר רנדומלי של סוכנים 
1) מאתחלים את המשתנים של ההקצאות להיות קבוצות ריקות ליתר בטחון 
1) לכל קטגוריה h רצים בלולאה עם הסדר המסוים של הסוכנים 

מפעילים RR (כל סוכן לפי הסדר לוקח את הפריט הכי משתלם עבורו)

מציירים גרף קנאה כל עוד אין לנו מעגלים ממשיכים הלאה

לפני צאתנו מהלולאה הופכים לסדר טופולוגי זה שדואג למי שאף אחד לא קינה בו לבחור ראשון בפעם הבאה יהיה לו סיכוי יותר גדול לקבל פריט יותר משתלם 



חוזרים על אותה פעולה עד שמסיימים לרוץ על כל הקטגוריות

האלגוריתם הזה מבטיח חלוקה הוגנת EF-1 בתנאי סביבה של אילוצי מטרואיד חלוקה זהים לאו דווקא הערכות זהות לחפצים פה דווקא אפשר להחליף חפצים בכדי לבטל מעגלי קנאה מכיוון שמדובר על אילוצי חלוקה זהים זה לזה 





**אלגוריתם 2 : CAPPED ROUND ROBIN**

מה שמייחד את האלגוריתם הזה זה שהוא מבטיח למצוא f-EF-1 בהנחה שמדובר על מטרואיד אחיד (קטגוריה אחת) וניתן שיהיה הערכות וקיבולת שונות לכל סוכן 

הסבר על הצעדים : 

קלט : קטגוריה C<sup>h</sup>  ואוסף K<sub>i</sub><sup>h</sup> (קיבולת מקסימלית לכל סוכן) וסדר כלשהו σ

1. מאתחלים:   L ← C<sup>h</sup> , P <a name="_hlk156595985"></a>← {i : k<sup>h</sup><sub>i</sub> = 0},  t←0,  ∀<i>i</i> ∈ [<i>n</i>] <i>X<sup>h</sup><sub>i</sub></i> ← ∅
1. `   `כל עוד L לא ריקה:
   1. i=σ[t]
   1. אם**∉p**  i: 
   1. g=argmax<sub>g∈L</sub>(v<sub>i</sub>(g)) (הכוונה הפריט עם ההערכה מקסמלית בעיני הסוכן i)
   1. X<sub>i</sub><sup>h</sup>= X<sub>i</sub><sup>h</sup> ∪ g
   1. L=L\{g}
   1. <b>אם K<sub>i</sub><sup>h</sup>  =| X<sub>i</sub><sup>h</sup>|</b> אז: מוסיפים את הסוכן i ל P (רשימת שסיימו)
   1. End-if
   1. End-if
   1. t=t+1mod n (באופן מעגלי)
1. end-while
1. return X<sup>h</sup>

הסבר בכמה מילים : 

כפי שאמרנו קודם האלגוריתם הזה מוגבל לקטגוריה אחת וניתן להיות הערכות וקיבולת שונה לכל סוכן. 
מתחילים מסדר כלשהו כל עוד שיש לנו פריטים לחלק בוחרים בסוכן הראשון בסדר הנ"ל והוא בוחר בפריט עם הערך הכי גבוה מבחינתו מוסיף אותו וכל זה בהנחה שעדיין לא הגיע לקיבולת מקסימלית שלו בעת כל הוספה בודקים אם הגיע למקסימום חוסמים אותו שלא יבחר עוד פעם 

וכך לכל סוכן עושים , ראוי לציין שאנחנו רצים באופן מעגלי ז"א כשמסיימים עם הסוכן האחרון ועדיין יש פריטים לחלק חוזרים לראשון ברשימה 



**טענה : אלגוריתם CRR תחת אילוץ מטרואיד אחיד מוצא לנו חלוקה F-EF1**

קודם כל ניגשים להוכיח ש לכל  i,j כך ש i מתחיל ראשון מתקיים 

<a name="_hlk156656347"></a>v<sub>i</sub>(X<sub>i</sub>)>= v<sub>i</sub>(Best<sub>i</sub>(X<sub>j</sub>)) במילים אחרות (החלוקה של i תמיד יותר טובה-שווה לתת חלוקה הכי טובה של j)  ואפשר להגיד שזה בקטע טריוויאלי כי לפי הלאגוריתם מי שבוחר ראשון מקבל את הערך הכי שווה בעיניו לכן מכיוון שכל פעם i בוחר לפני j הוא בטח יראה בעיניו שהחבילה שלו יותר טובה משל j לכן v<sub>i</sub>(X<sub>i</sub>)>= v<sub>i</sub>(Best<sub>i</sub>(X<sub>j</sub>))

עכשיו נותר להוכיח שהיא F-EF1 

נמשיך עם ההנחה ש i בוחר לפני j ונגיד שהוא בוחר ב g נוריד את ה g הזה שז"א j בחר ראשון לכן בטח מתקיים ש v<sub>j</sub>(X<sub>j</sub>)>= v<sub>j</sub>(Best<sub>j</sub>(X<sub>i</sub>/{g})) ז"א אין קנאה עד כדי פריט אחד 

מ.ש.ל 

**אלגוריתם 3 : CRR  עם 2 קטגוריות** 

הפעם אנו מרחיבים את אלגוריתם הקודם לעבוד על 2 קטגוריות משמעותו שהפעם הרחבנו ממטאויד אחיד למטרואיד חלוקה עם 2 קטגוריות דומות לכולם ייתכן שוני בקיבולת שזה מטופל במימוש של CRR המקורי

פסודו קוד :

1. יהי σ סדר כלשהוא של הסוכנים 
1. מפעילים את אלגוריתם 2 (CRR) עליו 
1. הופכים סדר (reverse order)
1. מפעילים אלגוריתם 2 (CRR) על הסדר ההפוך
1. איחוד לתוצאות של 2 ו 4 נותן לנו X חלוקה F-EF1

הוכחה של אלגוריתם 3 מאוד דומה לזו של 2 פשוט עם 2 קטגוריות הפעם


<a name="_hlk156684727"></a>**אלגוריתם 4 : קיבוליות שונות , הערכה זהה , קטגור זהה** 

קצת דומה מבחינת מבנה ל RR שבכל איטרציה משתמשים ב תת-תהליך 

הפעם מדובר על CRR  בכל איטרציה עם סדר טופולוגי מהפך לאלגוריתם 1 פה יש לימה שמוכיחה שלא נצטרך להוריד מעגלים מגרף הקנאה כי בכלל לא יהיה תחת האילוצים הנ"ל (שזה טוב לנו כי במקרה של קיבוליות שונות אנחנו מסתכנים בלהפר על האילוץ של הקיבולת כשמחליפים באנדלים בין סוכנים).

פסודו-קוד-מלל:

1. מאתחלים את החולוקות X<sub>i</sub> לקבוצות ריקות ,  σ,  סדר אקראי
1. עבור כל C<sup>h</sup> : 
   1. מפעילים CRR(C<sup>h</sup>, σ,)
   1. עבור כל סוכן i מאחדים את החלוקה שלו עם ה X<sub>i</sub> 
   1. משנים את σ, להיות סדר טופולוגי של גרף הקנאה הישים 
1. End-for

**לימה : לכל הגדרה תחת הערכות שווי זהות (שייתכן קיבולת שונה), גרף הקנאה של כל חלוקה ישימה אפשרית יהיה תמיד חסר מעגלים**






**אלגוריתם 5: קיבוליות שונות , הערכה בינרית , קטגור זהה** 

1. מאתחלים לכל i , X<sub>i</sub> לקבוצה ריקה
1. עבור כל קטגוריה :
   1. לכל i מאתחלים X<sub>i</sub><sup>h</sup> לקבוצה ריקה
   1. T<sup>h</sup>=max(K<sub>i</sub><sup>h</sup> for every i) הכוונה קיבולת מקסימלית 
   1. עבור כל t מ 1 עד ..... T<sup>h</sup> :
      1. נבנה גרף של סוכן-משאב <a name="_hlk156719871"></a>G<sup>h</sup><sub>t</sub>
      1. נבנה גרף כנאה בהינתן X
      1. משנים את <a name="_hlk156719814"></a>σ, להיות סדר טופולוגי של גרף הקנאה הישים
1. למצוא תיאום מקסימלי (priority matching) בהתאם ל σ ו G<sup>h</sup><sub>t</sub> 
1. לכל סוכן שהותאם לו ב   G<sub>t</sub><sup>h</sup> מכניסים את הפריטים שהותאמו לו ל X<sup>h</sup><sub>i</sub> שלו 
1. End-for
   1. במידה ועדיין קיים פריטים ב h שלא הוקצאו תן באופן אקראי לסוכנים שעדיין יש להם קיבולת 
   1. End-for 



**הגדרות קשורות לאלגוריתם :** 

1. **גרף פריט-סוכן :** 

הגרף הזה הוא גרף שבכל תת מחלוקת X בהינתן קטגוריה h הוא גרף דו-צדדי שמכיל בצד שמאל את הסוכנים שלא הגיעו למקסימום שלהם מבחינת קיבולת ובצד ימין את הפריטים של קטגוריה h שעוד לא חולקו לאף אחד וחץ מן סוכן ל פריט זה אומר שהסוכן רוצה את הפריט הזה (vi(item)=1)



1. **תיאום מקסימלי (מועדף):**  מתחילים מתיאום בהינתן G=(V,E) תיאום זה בשתי מילים תת קבוצה של הצלעות E כך שכל קודקוד מופיע לכל היותר פעם אחת בקצוות הצלעות (במקרה שלנו כשמדובר על גרף פריט-סוכן לא ניתן שסוכן בתיאום כלשהו ייקח 2 פריטים , ויתר על כך פריט אחד לא יופיע ל 2 סוכנים בתיאום כלשהו שזה טוב והגיוני במקרה שלנו ) תיאום מקסימלי זה פשוט התיאום עם הכי הרבה אחדות בוויקטור שמגדירים אותו להיות וקטור הסוכנים במקרה שלנו[n] (ב 2 מילים התיאום הכי טוב זה התיאום שבו חילקנו להכי הרבה סוכנים בכל איטרציה ) הסדר בוויקטור חשוב 

**הסבר בקצרה על אלגוריתם 5 :**

האלגוריתם עובר בלולאה על הקטגוריות כך שבכל קטגוריה יש לצייר גרף של סוכן-פריט ומתוך הגרף הזה למצוא את התיאום המקסימלי(טוב ביותר)ּשזה כרוך בסדר הטופולוגי של גרף הקנאה (מובטח בלמה שלא יהיה מעגלים לטפל בהןְְְ)ואז לפי התיאום לחלק את הפריטים לכל סוכן
חוזרים על אותו תהליך לכל היותר עד Th= ∀i Maxkh   הקיבולת המקסימלית מבין הסוכנים 
בסוף מגיעים לשלב של לתת את השאריות באופן אקראי לסוכנים 
אם חושבים קצת אפשר להסיק שאחרי  Th איטרציות במקרה הגרוע יש כאלה שעדיין לא הגיעו למקסימום של הקיבולת שלהם מכיוון שפריטים שרצו לא קיבלו לפי המאצ'נג המקסמלים ז"א שהפריטים בשארית הם בוודאי שוות ל 0 בשבילם כי אחרת היו מקבלים אותן בשלב הראשון 

ובסוף האלגוריתם מבטיח לתת לנו חלוקה של F-EF1 

**לימה שמעידה על נכונות של אלגוריתם 5: בכל איטירציה באלגוריתם 5 :** 

1. **אין מעגלים בגרף הקנאה** 
1. **כל 2 סוכנים הקנאה בינהם היא לכל היותר על פריט 1 (F-EF1)**

**משפט : לכל 2 סוכנים עם אילוצי קיבולת שונים קיים פתרון שאפשר לחשב אותו ביעילות דרך אלגוריתם 6** RR2

**יעילות פאריטו : תחת הגדרה של קיבוליות בינריות אלגוריתם 5 מבטיח להחזיר לנו חלוקה יעילה פאריטו**

**אלגוריתם 6 :**  RR2

קלט : M קבוצת הפריטים , קטגוריות C1……..,Cl  ו קיבוליות ∀i,h (kh)

לכל i = 1, 2, h ∈ [l]; a ∈ {1, 2}

1. מאתחלים סדר קטגוריות יורד i ∈ 1, 2: Xi ← Ø; πi ←sʰ(R(v₁, v₂, i)).
1. **WHILE** כל עוד קיימות קטגוריות שלא הוקצו : 
   1. h =הקטגוריה הראשונה בסדר של סוכן a שעוד לא נתפסה ע"יי סוכן אחר 
   1. תפעיל CRR (אלגוריתם 2) על קטגוריה h כך ש Xʰ ← R(v₁, v₂, a)ʰ\
      (CRR כך ש a מתחיל לבחור כך ש v1 זו פונקציית ההערכה שלו והשניה להפך)
   1. לכל סוכן i ∈ 1, 2, let Xi ← Xi ∪ Xʰ.
   1. נחליף את a  להיות השחקן השני 
1. **END-WHILE** 

**לימה :  לכל קטגוריה** h  **ולכל** i∈{1,2} **מתקיים:**

sʰ(R(v₁, v₂, i)ʰ) ≥ -sʰ(R(v₁, v₂, -i)ʰ).

**הלימה לעיל גוררת את המשפט פתיחה שמבטיח חלוקה  F-EF1**

**הסבר והגדרות רלוונטיות :** 

• בהינתן הקצאה X, ה(surplus) של סוכן i בקטגוריה h הוא

sʰ(X) := vˆi(X<sub>i</sub>ʰ) − vˆi(X<sub>j</sub>ʰ). (ההפרש בין הערך של חבילת i לבין ערך חבילה j בעיניים של i כמובן ז"א לפי הפונקציית ערך שווי של סוכן i)

- R(<i>v, v</i><sup>′</sup><i>, ℓ</i>)<i><sup>h</sup>  : המשמעות של הביטוי זה שאנחנו מפעילם אלגוריתם 2 CRR לשני סוכנים תחת קטגוריה h כך ש</i> l</i> בוחר ראשון v,v' הם פשוט פונקציות ההערכה של שני הסוכנים.

**הסבר על מהלך האלגוריתם :**

החוכמה באלגוריתם הזה זה שהוא משתמש בכלי חזק 2 ב 1 אם נפעיל את ה surplus(CRR(v1,v2,l)<sup>h</sup>) זה ייתן לנו כמה סוכן l מרוויח כשהוא מתחיל ראשון , ובשכבה הפנימית יש לנו את החלוקה F-EF1 שאלגוריתם 2 מבטיח בהינתן שסוכן l  התחיל ראשון ! מה נרצה יותר מזה ?  .

בשתי מילים יותר פורמלי להגיד שלכל סוכן i אנו מסדרים את את קבוצת ה surplus(CRR(v1,v2,i)<sup>h</sup>) בסדר יורד כך שהראשון ברשימה זה הכי כדאי לבחור (כל עוד שהקטגוריה לא תפוסה ע"י סוכן j)  כשבוחרים בוחרים גם בחלוקה של הCRR שכרוך בה , עוברים לסוכן j הוא בוחר את הראשון ברשימה שזה לא קטגוריה h הקודמת וכן הלאה …….. 

**אלגוריתם 7: Iterated Swaps**

בשביל להתחיל לדבר על אלגוריתם אחרון של המאמר נצטרך הקדמה קצרה 

- באלגוריתם הזה נדון במטרואידות BO  שהן מעבר למטרואידות שראינו בהתחלה 
- הגדרה : מטרואיד BO הוא מטרואיד שלכל I,J∈Iהקבוצות הבלתי תלויות קיימת פונקציה חח"ע ועל μ : I ↔ J כך ש

` `I - x + μ(x) ∈ I and J - μ(x) + x ∈ I.

*נחזור בלהזכיר ולהדגיש שאחד הדברים הבלתי אפשריים זה היה :* 

*במידה ויש לנו אילוצי מטרואיד חלוקה שונים לכל סוכן לאו דווקא נוכל למצוא חלוקה F-EF1 לכן  נתמקד במטרואיד זהה לכולם (COMMON MATROID)*

*נצטרך להציג 2 כלים חשובים וטובים לכל סוגי מטרואידים :* 

1. *Social-Welfare maximizing allocation :*

*באלגוריתם שלנו בשלב הראשון משתמשים בזה כדי למצוא הקצאה*/חלוקה ממקסמת את חבילות של הסוכנים אפשר למתצוא אותה בסיבוכיות זמן פולינומית 

**משפט שתומך בטענה הקודמת : לכל מטרואיד משותף ו n סוכנים אפשר למצוא חלוקה *Social-Welfare maximizing  בזמן פולינומי*** 

1. *להבטיח חלוקה לבסיסים :* 

*כדי להבטיח דבר כזה נוסיף פריטים חסרי ערך עד שנגיע למצב שהגודל של קבוצת הפריטים זה n\*r כך ש  r=rank(M) הגודל המקסמלי של חלוקה שלא עוברת על הכללים* 

*דרך free extension  נדאג שלא יפגע בחלוקות הישימות הקודמות גם*

*הגדרה: יהי מטרואיד M נגדיר* M'  *להיות המטרואיד החדש כך ש* 

*M* <sup>′</sup> := *M* + *x*<sup>new</sup>;

I<sup>′</sup> := I  ∪  {*I* + *x*<sup>new</sup> | *I* ∈ I*,* |*I*| ≤ *r* − 1}*.*

*ז"א שמה שהיה ישים ב M ישאר ישים וגם את החלוקות הלא מקסמליות הישימות נשארו ישימות אפילו אחרי הוספת x*<sup>new</sup>









***פסודו אלגוריתם 7 :*** 

*קלט : אילוצי מטרואיד BEYOND ORDERABLE* MAT*, n סוכנים עם הערכות שווי אדטיביות , קבוצת פריטים* M*, כך שהגודל שלה הוא* n\*rank(MAT)

1. *מאתחלים X <- חלוקה ממקסמת סושייל ולפייר מלאה* 
1. ` `*While כל עוד X הוא לא EF1 עשה :*
   1. *תמצאN*  i,j ∈  *כך ש סוכן i מקנא ב j ביותר מפריט אחד* 
   1. <i>תמצא פונקציה  µ : X<sub>i</sub> ↔ X<sub>j</sub>. שתחליף פריט בתמורת פריט</i>
   1. <i>תמצא פריט</i> giϵXi <i>כך ש v<sub>i</sub>(µ(g<sub>i</sub>)) > v<sub>i</sub>(g<sub>i</sub>).</i>
   1. <i>תחליף g<sub>i</sub> ב  µ(g<sub>i</sub>)</i>
1. *End-while*

*הסבר :* 

*כפי שמתואר בפסודו מתחילים מ X חלוקה ממקסמת social-welfare* 

*וכל עוד שיש לנו עבירה על EF1 אנו מחליפים דרך swapping  בין כל 2 סוכנים כך שהראשון מקנה בשני מעבר לפריט אחד (מכיוון שההחסרה וההוספה הן באותה כמות זה לא מפר על SWM) בסוף מקבלים EF-1*

*בתתי פרקים הבאים נדבר על קלט שבוודאות יבטיח לנו הקצאה EF1 בזמן פולינומי*

1. ***3 סוכנים עם הערכות שווי בינריות*** 

***משפט שמוכיח את ההגדרה :  תחת אילוצי מטרואיד base-orderable זהים ל 3 סוכנים עם הערכות שווי בינריות שונות בין זה לזה אלגוריתם 7 (iterated swaps) מבטיח למצוא חלוקה EF-1 בזמן פולינומי ייתר על כך התואצה היא גם SWM ז"א יעילה פאריטו גם.***

1. ***2 סוכנים עם הערכות שווי אדיטיביות*** 


***ראיות לעתיד :*** 

1. *תשקלו את ההגדרה של n סוכנים עם הערכות שווי אדיטביות שונות ומטרואידי חלוקה עם קיבוליות שונות , ומספר קטגוריות >= 3 
   האם חלוקה EF-1  קיימת ? (אלגוריתם 3 הצליח לכל היותר ב2 קטגוריות)*

1. *תשקלו את ההגדרה של n סוכנים עם הערכות שווי אדיטביות זהות האם קיים סוג מטרואידים חוץ ממטרואיד חלוקה עם אותם קטגוריות (אלגוריתם 4) כך שהקצאה EF-1 קיימת אפילו כשהאילוצים שונים ?*

1. *תשקלו את ההגדרה של n סוכנים עם הערכות בינריות קיבלויות שונות והקיבולת יכולה להיות >=2 האם קיימת חלוקה יעילה פאריטו וEF1 ?  (באלגוריתם 5 טופל במקרה של קיבולת בינרית )*

1. *תשקלו את ההגדרה של  k>=3סוכנים עם הערכות אדיטביות שונות וקיבוליות שונות גם האם קיים פתרון EF1 ? (באלגוריתם 6 מטפלים במקרה של 2 סוכנים)*

1. *תשקלו את ההגדרה של k>=4  סוכנים עם אילוצי מטרואיד BO והערכות בינריות , או אפילו 3 סוכנים עם הערכה בירית ואילוצי מטרואיד כלליים ,  או 3 סוכנים עם הערכות אדיטביות ואילוצי מטרואידBO  , האם קיים פתרון EF1 ? (אלגוריתם 7 מטפל במקרה של 3 סוכנים הערכות בינריות ומטרואידי BO)*

1. *עוד כיוון מעניין זה להרחיב את התוצאות להגדרה שיש בה חפצים עם ערך שלילי בנוסף לחפצים הנורמליים.*




20

